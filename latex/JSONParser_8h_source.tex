\hypertarget{JSONParser_8h_source}{}\doxysection{JSONParser.\+h}
\label{JSONParser_8h_source}\index{include/JSONParser.h@{include/JSONParser.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// libdas: DENG asset handling management library}}
\DoxyCodeLine{2 \textcolor{comment}{// licence: Apache, see LICENCE file}}
\DoxyCodeLine{3 \textcolor{comment}{// file: JSONParser.h -\/ JSON parsing class header}}
\DoxyCodeLine{4 \textcolor{comment}{// author: Karl-\/Mihkel Ott}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#ifndef JSON\_PARSER\_H}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#define JSON\_PARSER\_H}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#ifdef JSON\_PARSER\_CPP}}
\DoxyCodeLine{11 \textcolor{preprocessor}{    \#include <any>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{    \#include <variant>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{    \#include <map>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{    \#include <fstream>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{    \#include <memory>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{    \#include <vector>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{    \#include <string>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{    \#include <cstring>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{    \#include <utility>}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{preprocessor}{    \#include <ErrorHandlers.h>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{    \#include <AsciiStreamReader.h>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceLibdas}{Libdas}} \{}
\DoxyCodeLine{27 }
\DoxyCodeLine{28     \textcolor{keyword}{enum} JSONToken \{}
\DoxyCodeLine{29         JSON\_TOKEN\_SCOPE\_START,}
\DoxyCodeLine{30         JSON\_TOKEN\_SCOPE\_END,}
\DoxyCodeLine{31         JSON\_TOKEN\_ARRAY\_START,}
\DoxyCodeLine{32         JSON\_TOKEN\_ARRAY\_END,}
\DoxyCodeLine{33         JSON\_TOKEN\_STRING\_STATEMENT,}
\DoxyCodeLine{34         JSON\_TOKEN\_BOOLEAN,}
\DoxyCodeLine{35         JSON\_TOKEN\_NUMERICAL,}
\DoxyCodeLine{36         JSON\_TOKEN\_KEY\_VALUE\_DECL,}
\DoxyCodeLine{37         JSON\_TOKEN\_NEXT\_ELEMENT,}
\DoxyCodeLine{38         JSON\_TOKEN\_UNKNOWN}
\DoxyCodeLine{39     \};}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 }
\DoxyCodeLine{42     \textcolor{keyword}{typedef} uint8\_t JSONType;}
\DoxyCodeLine{43 \textcolor{preprocessor}{    \#define JSON\_TYPE\_STRING    0x01}}
\DoxyCodeLine{44 \textcolor{preprocessor}{    \#define JSON\_TYPE\_FLOAT     0x02}}
\DoxyCodeLine{45 \textcolor{preprocessor}{    \#define JSON\_TYPE\_INTEGER   0x04}}
\DoxyCodeLine{46 \textcolor{preprocessor}{    \#define JSON\_TYPE\_BOOLEAN   0x08}}
\DoxyCodeLine{47 \textcolor{preprocessor}{    \#define JSON\_TYPE\_OBJECT    0x10}}
\DoxyCodeLine{48 \textcolor{preprocessor}{    \#define JSON\_TYPE\_UNKNOWN   0x20}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{comment}{// JSON data type definitions}}
\DoxyCodeLine{52     \textcolor{keyword}{typedef} std::string JSONString;}
\DoxyCodeLine{53     \textcolor{keyword}{typedef} \textcolor{keywordtype}{float} JSONNumber;}
\DoxyCodeLine{54     \textcolor{keyword}{typedef} int32\_t JSONInteger;}
\DoxyCodeLine{55     \textcolor{keyword}{typedef} \textcolor{keywordtype}{bool} JSONBoolean;}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{comment}{// Value and subnode type declarations for easier typing}}
\DoxyCodeLine{59     \textcolor{keyword}{struct }JSONNode;}
\DoxyCodeLine{60     \textcolor{keyword}{typedef} std::vector<std::pair<JSONType, std::any>> JSONValues;}
\DoxyCodeLine{61     \textcolor{keyword}{typedef} std::map<std::string, std::shared\_ptr<JSONNode>> SubnodeMap;}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{keyword}{struct }\mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}} \{}
\DoxyCodeLine{64         \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}}() \{\}}
\DoxyCodeLine{65         \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}} \&\_node) \{ *\textcolor{keyword}{this} = \_node; \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67         \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}} *parent = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{68         std::string name = \textcolor{stringliteral}{"{}root"{}};}
\DoxyCodeLine{69         SubnodeMap sub\_nodes = \{\};}
\DoxyCodeLine{70         JSONValues values;}
\DoxyCodeLine{71         uint32\_t key\_val\_decl\_line = 1;}
\DoxyCodeLine{72 }
\DoxyCodeLine{73         \textcolor{comment}{// flags for data reading}}
\DoxyCodeLine{74         \textcolor{keywordtype}{bool} is\_scope\_open = \textcolor{keyword}{false};}
\DoxyCodeLine{75         \textcolor{keywordtype}{bool} is\_array\_open = \textcolor{keyword}{false};}
\DoxyCodeLine{76     \};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 }
\DoxyCodeLine{79     \textcolor{keyword}{class }\mbox{\hyperlink{classLibdas_1_1JSONParser}{JSONParser}} : \textcolor{keyword}{public} \mbox{\hyperlink{classLibdas_1_1AsciiStreamReader}{AsciiStreamReader}} \{}
\DoxyCodeLine{80         \textcolor{keyword}{private}:}
\DoxyCodeLine{81             \mbox{\hyperlink{classLibdas_1_1AsciiFormatErrorHandler}{AsciiFormatErrorHandler}} m\_error;}
\DoxyCodeLine{82             \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}} m\_root\_node;}
\DoxyCodeLine{83             \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}} *m\_active\_node = \&m\_root\_node;}
\DoxyCodeLine{84 }
\DoxyCodeLine{85             std::string m\_file\_name;}
\DoxyCodeLine{86             \textcolor{keywordtype}{char} *m\_rd\_ptr = m\_buffer;}
\DoxyCodeLine{87             \textcolor{keywordtype}{char} m\_str\_statement\_beg = 0;}
\DoxyCodeLine{88             \textcolor{keywordtype}{bool} m\_allow\_next\_element = \textcolor{keyword}{true}; \textcolor{comment}{// flag that determines if }}
\DoxyCodeLine{89 }
\DoxyCodeLine{90             std::string m\_loose\_string = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{91 }
\DoxyCodeLine{92             \textcolor{comment}{// variable for accounting lines}}
\DoxyCodeLine{93             \textcolor{keywordtype}{size\_t} m\_line\_nr = 1;}
\DoxyCodeLine{94             \textcolor{keywordtype}{bool} m\_prev\_decl = \textcolor{keyword}{false}; \textcolor{comment}{// boolean flag for identifying previous key value statement}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96         \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{97 \textcolor{comment}{            ////////////////////////////////}}
\DoxyCodeLine{98 \textcolor{comment}{}            \textcolor{comment}{// ***** Token handling ***** //}\textcolor{comment}{}}
\DoxyCodeLine{99 \textcolor{comment}{            ////////////////////////////////}}
\DoxyCodeLine{100 \textcolor{comment}{}            }
\DoxyCodeLine{101             \textcolor{keywordtype}{void} \_HandleScopeStartToken();}
\DoxyCodeLine{102             \textcolor{keywordtype}{void} \_HandleScopeEndToken();}
\DoxyCodeLine{103             \textcolor{keywordtype}{void} \_HandleArrayStartToken();}
\DoxyCodeLine{104             \textcolor{keywordtype}{void} \_HandleArrayEndToken();}
\DoxyCodeLine{105             \textcolor{keywordtype}{void} \_HandleStringToken();}
\DoxyCodeLine{106             \textcolor{keywordtype}{void} \_HandleBooleanToken();}
\DoxyCodeLine{107             \textcolor{keywordtype}{void} \_HandleNumericalToken();}
\DoxyCodeLine{108             \textcolor{keywordtype}{void} \_HandleNextElementToken();}
\DoxyCodeLine{109             \textcolor{keywordtype}{void} \_HandleKeyValueDeclToken();}
\DoxyCodeLine{110 \textcolor{comment}{}}
\DoxyCodeLine{111 \textcolor{comment}{            /**}}
\DoxyCodeLine{112 \textcolor{comment}{             * Check the current char and idenitfy possible token value}}
\DoxyCodeLine{113 \textcolor{comment}{             * @return JSONToken value specifying the identified token}}
\DoxyCodeLine{114 \textcolor{comment}{             */}}
\DoxyCodeLine{115             JSONToken \mbox{\hyperlink{classLibdas_1_1JSONParser_a94ff727335ff0a27cb676151b50c694c}{\_CheckForToken}}();\textcolor{comment}{}}
\DoxyCodeLine{116 \textcolor{comment}{            /**}}
\DoxyCodeLine{117 \textcolor{comment}{             * Check which action to take according to the specified token}}
\DoxyCodeLine{118 \textcolor{comment}{             * @param \_token specifies the token which determines the action to be taken}}
\DoxyCodeLine{119 \textcolor{comment}{             */}}
\DoxyCodeLine{120             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1JSONParser_a792fe74ab98bfada9919dbfbb4ef331d}{\_CheckTokenAction}}(JSONToken \_token);\textcolor{comment}{}}
\DoxyCodeLine{121 \textcolor{comment}{            /**}}
\DoxyCodeLine{122 \textcolor{comment}{             * Skip all whitespaces and other skippable characters }}
\DoxyCodeLine{123 \textcolor{comment}{             * @param \_no\_nl is a boolean value that specifies, if true, that no newlines would be skipped}}
\DoxyCodeLine{124 \textcolor{comment}{             */}}
\DoxyCodeLine{125             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1JSONParser_aa73d7257193dee95bce61489817b44d0}{\_SkipSkippableCharacters}}(\textcolor{keywordtype}{bool} \_no\_nl = \textcolor{keyword}{false});}
\DoxyCodeLine{126 }
\DoxyCodeLine{127         \textcolor{keyword}{public}:}
\DoxyCodeLine{128             \mbox{\hyperlink{classLibdas_1_1JSONParser}{JSONParser}}(ModelFormat \_format, \textcolor{keyword}{const} std::string \&\_file\_name = \textcolor{stringliteral}{"{}"{}});\textcolor{comment}{}}
\DoxyCodeLine{129 \textcolor{comment}{            /**}}
\DoxyCodeLine{130 \textcolor{comment}{             * Parse the JSON file and create appropriate maps for each node}}
\DoxyCodeLine{131 \textcolor{comment}{             * @param \_file\_name optionally specifies the JSON file name to use, can be ignored if the file name was provided in constructor}}
\DoxyCodeLine{132 \textcolor{comment}{             */}}
\DoxyCodeLine{133             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1JSONParser_a2091fcbc79c9823d24d5d4269012c23d}{Parse}}(\textcolor{keyword}{const} std::string \&\_file\_name = \textcolor{stringliteral}{"{}"{}});\textcolor{comment}{}}
\DoxyCodeLine{134 \textcolor{comment}{            /**}}
\DoxyCodeLine{135 \textcolor{comment}{             * Get the root node of parsed JSON nodes}}
\DoxyCodeLine{136 \textcolor{comment}{             * @return reference to JSONNode object that is the root of all other objects}}
\DoxyCodeLine{137 \textcolor{comment}{             */}}
\DoxyCodeLine{138             \mbox{\hyperlink{structLibdas_1_1JSONNode}{JSONNode}} \&\mbox{\hyperlink{classLibdas_1_1JSONParser_ab1a68e5c46ecd220a43ff4de9aea7b67}{GetRootNode}}();}
\DoxyCodeLine{139     \};}
\DoxyCodeLine{140 \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142 }
\DoxyCodeLine{143 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
