\hypertarget{STLParser_8h_source}{}\doxysection{STLParser.\+h}
\label{STLParser_8h_source}\index{include/STLParser.h@{include/STLParser.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/// libdas: DENG asset handling management library}\textcolor{comment}{}}
\DoxyCodeLine{2 \textcolor{comment}{/// licence: Apache, see LICENCE file}}
\DoxyCodeLine{3 \textcolor{comment}{/// file: STLParser.h -\/ STL parser class header}}
\DoxyCodeLine{4 \textcolor{comment}{/// author: Karl-\/Mihkel Ott}}
\DoxyCodeLine{5 \textcolor{comment}{}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#ifndef STL\_PARSER\_H}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#define STL\_PARSER\_H}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#ifdef STL\_PARSER\_CPP}}
\DoxyCodeLine{11 \textcolor{preprocessor}{    \#include <cstring>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{    \#include <string>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{    \#include <iostream>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{    \#include <vector>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{    \#include <fstream>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{    \#include <unordered\_map>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{    \#include <Points.h>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{    \#include <LibdasAssert.h>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{    \#include <ErrorHandlers.h>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{    \#include <AsciiStreamReader.h>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{    \#include <AsciiLineReader.h>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{    \#include <STLStructures.h>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define STL\_BINARY\_SIGNATURE\_SIZE       80}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceLibdas}{Libdas}} \{}
\DoxyCodeLine{30 }
\DoxyCodeLine{31     \textcolor{keyword}{enum} AsciiSTLStatementType \{}
\DoxyCodeLine{32         ASCII\_STL\_STATEMENT\_NONE,                       \textcolor{comment}{// special value to define empty newline}}
\DoxyCodeLine{33         ASCII\_STL\_STATEMENT\_SOLID,                      \textcolor{comment}{// solid}}
\DoxyCodeLine{34         ASCII\_STL\_STATEMENT\_FACET,                      \textcolor{comment}{// facet}}
\DoxyCodeLine{35         ASCII\_STL\_STATEMENT\_OUTER\_LOOP,                 \textcolor{comment}{// outer loop}}
\DoxyCodeLine{36         ASCII\_STL\_STATEMENT\_VERTEX,                     \textcolor{comment}{// vertex}}
\DoxyCodeLine{37         ASCII\_STL\_STATEMENT\_ENDLOOP,                    \textcolor{comment}{// endloop}}
\DoxyCodeLine{38         ASCII\_STL\_STATEMENT\_ENDFACET,                   \textcolor{comment}{// endfacet}}
\DoxyCodeLine{39         ASCII\_STL\_STATEMENT\_ENDSOLID                    \textcolor{comment}{// endsolid}}
\DoxyCodeLine{40     \};}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \textcolor{keyword}{struct }\mbox{\hyperlink{structLibdas_1_1AsciiSTLStatementCallback}{AsciiSTLStatementCallback}} \{}
\DoxyCodeLine{44         AsciiSTLStatementType type;}
\DoxyCodeLine{45         STLFunctions::PTR\_KeywordCallback keyword\_callback; }
\DoxyCodeLine{46 }
\DoxyCodeLine{47         \mbox{\hyperlink{structLibdas_1_1AsciiSTLStatementCallback}{AsciiSTLStatementCallback}}() : type(ASCII\_STL\_STATEMENT\_NONE), keyword\_callback(\textcolor{keyword}{nullptr}) \{\}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49         \mbox{\hyperlink{structLibdas_1_1AsciiSTLStatementCallback}{AsciiSTLStatementCallback}}(\textcolor{keyword}{const} AsciiSTLStatementType \&\_type, \textcolor{keyword}{const} STLFunctions::PTR\_KeywordCallback \&\_kw\_callback) :}
\DoxyCodeLine{50             type(\_type), keyword\_callback(\_kw\_callback) \{\}}
\DoxyCodeLine{51     \};}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{keyword}{class }\mbox{\hyperlink{classLibdas_1_1AsciiSTLParser}{AsciiSTLParser}} : \textcolor{keyword}{private} \mbox{\hyperlink{classLibdas_1_1AsciiLineReader}{AsciiLineReader}} \{}
\DoxyCodeLine{55         \textcolor{keyword}{private}:}
\DoxyCodeLine{56             \mbox{\hyperlink{classLibdas_1_1AsciiFormatErrorHandler}{AsciiFormatErrorHandler}} m\_error;}
\DoxyCodeLine{57             std::unordered\_map<std::string, AsciiSTLStatementCallback> m\_tokens;}
\DoxyCodeLine{58             std::vector<STLObject> m\_objects;}
\DoxyCodeLine{59             uint32\_t m\_parse\_pos = 1;}
\DoxyCodeLine{60 }
\DoxyCodeLine{61             \textcolor{comment}{// boolean flags for defining facet, vertex loop and solid object reading statuses}}
\DoxyCodeLine{62             \textcolor{keywordtype}{bool} m\_is\_solid\_obj = \textcolor{keyword}{false};}
\DoxyCodeLine{63             \textcolor{keywordtype}{bool} m\_is\_facet = \textcolor{keyword}{false};}
\DoxyCodeLine{64             \textcolor{keywordtype}{bool} m\_is\_loop = \textcolor{keyword}{false};}
\DoxyCodeLine{65 }
\DoxyCodeLine{66         \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{67 \textcolor{comment}{            /** }}
\DoxyCodeLine{68 \textcolor{comment}{             * Create all possible tokens to consider for Wavefront Obj format}}
\DoxyCodeLine{69 \textcolor{comment}{             */}}
\DoxyCodeLine{70             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_a90be9504f282ed5bdb6d1df528d47fe4}{\_Tokenise}}();\textcolor{comment}{}}
\DoxyCodeLine{71 \textcolor{comment}{            /**}}
\DoxyCodeLine{72 \textcolor{comment}{             * Analyse the keyword and if it is valid return its callback}}
\DoxyCodeLine{73 \textcolor{comment}{             * @param \_key is the key to use in retrieving from the keyword map}}
\DoxyCodeLine{74 \textcolor{comment}{             * @return on success AsciiSTLStatementCallback instance that includes a valid type and data pointer to statement callback}}
\DoxyCodeLine{75 \textcolor{comment}{             */}}
\DoxyCodeLine{76             \mbox{\hyperlink{structLibdas_1_1AsciiSTLStatementCallback}{AsciiSTLStatementCallback}} \mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_aaf531fae1923da3a128b16f81194c09b}{\_AnalyseKeyword}}(\textcolor{keyword}{const} std::string \&\_key);\textcolor{comment}{}}
\DoxyCodeLine{77 \textcolor{comment}{            /**}}
\DoxyCodeLine{78 \textcolor{comment}{             * Analyse the statement and call its callback function if it exists}}
\DoxyCodeLine{79 \textcolor{comment}{             * @param \_callback is an AsciiSTLStatement instance that defines the function pointer}}
\DoxyCodeLine{80 \textcolor{comment}{             * @param \_args is an std::vector instance of all read arguments}}
\DoxyCodeLine{81 \textcolor{comment}{             */}}
\DoxyCodeLine{82             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_ae9f140016c6ff60e09de250ae6c3aebe}{\_AnalyseStatement}}(\mbox{\hyperlink{structLibdas_1_1AsciiSTLStatementCallback}{AsciiSTLStatementCallback}} \&\_callback, std::vector<std::string> \&\_args);\textcolor{comment}{}}
\DoxyCodeLine{83 \textcolor{comment}{            /**}}
\DoxyCodeLine{84 \textcolor{comment}{             * Get the correct callback function custom data according to the specified type}}
\DoxyCodeLine{85 \textcolor{comment}{             * @param \_type is a AsciiSTLStatementType value that describes the statement type}}
\DoxyCodeLine{86 \textcolor{comment}{             */}}
\DoxyCodeLine{87             \textcolor{keywordtype}{void} *\mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_a2d69fcbb18924e3a29a6a988aa47f883}{\_GetCustomData}}(AsciiSTLStatementType \_type);}
\DoxyCodeLine{88         }
\DoxyCodeLine{89         \textcolor{keyword}{public}:}
\DoxyCodeLine{90             \mbox{\hyperlink{classLibdas_1_1AsciiSTLParser}{AsciiSTLParser}}(\textcolor{keyword}{const} std::string \&\_file\_name = \textcolor{stringliteral}{"{}"{}}, \textcolor{keywordtype}{size\_t} \_chunk\_size = DEFAULT\_CHUNK);\textcolor{comment}{}}
\DoxyCodeLine{91 \textcolor{comment}{            /**}}
\DoxyCodeLine{92 \textcolor{comment}{             * Parse the currently loaded file given as a parameter in constructor}}
\DoxyCodeLine{93 \textcolor{comment}{             */}}
\DoxyCodeLine{94             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_a9f0ae6a4104a151b3de23272cf3fd521}{Parse}}();\textcolor{comment}{}}
\DoxyCodeLine{95 \textcolor{comment}{            /**}}
\DoxyCodeLine{96 \textcolor{comment}{             * Parse completely new file}}
\DoxyCodeLine{97 \textcolor{comment}{             */}}
\DoxyCodeLine{98             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_a3db001a5e2a48275e0ee9e5fe477ed28}{Parse}}(\textcolor{keyword}{const} std::string \&\_file\_name);\textcolor{comment}{}}
\DoxyCodeLine{99 \textcolor{comment}{            /**}}
\DoxyCodeLine{100 \textcolor{comment}{             * Get all parsed STL objects}}
\DoxyCodeLine{101 \textcolor{comment}{             * @return reference to std::vector instance containing all STL objects}}
\DoxyCodeLine{102 \textcolor{comment}{             */}}
\DoxyCodeLine{103             std::vector<STLObject> \&\mbox{\hyperlink{classLibdas_1_1AsciiSTLParser_ac210eae495488eb45d15420861d1c805}{GetObjects}}();}
\DoxyCodeLine{104     \};}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{comment}{}}
\DoxyCodeLine{107 \textcolor{comment}{    /**}}
\DoxyCodeLine{108 \textcolor{comment}{     * Binary STL file header data structure}}
\DoxyCodeLine{109 \textcolor{comment}{     */}}
\DoxyCodeLine{110 \textcolor{preprocessor}{\#pragma pack(push, 1)}}
\DoxyCodeLine{111     \textcolor{keyword}{struct }\mbox{\hyperlink{structLibdas_1_1BinarySTLHeader}{BinarySTLHeader}} \{}
\DoxyCodeLine{112         \textcolor{keywordtype}{char} signature[80];}
\DoxyCodeLine{113         uint32\_t facet\_c;}
\DoxyCodeLine{114 }
\DoxyCodeLine{115         \mbox{\hyperlink{structLibdas_1_1BinarySTLHeader}{BinarySTLHeader}}() : facet\_c(0) \{}
\DoxyCodeLine{116             std::memset(signature, 0, 80 * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{117         \}}
\DoxyCodeLine{118     \};}
\DoxyCodeLine{119 \textcolor{preprocessor}{\#pragma pack(pop)}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keyword}{class }\mbox{\hyperlink{classLibdas_1_1BinarySTLParser}{BinarySTLParser}} \{}
\DoxyCodeLine{123         \textcolor{keyword}{private}:}
\DoxyCodeLine{124             \mbox{\hyperlink{structLibdas_1_1BinarySTLHeader}{BinarySTLHeader}} m\_header;}
\DoxyCodeLine{125             \mbox{\hyperlink{classLibdas_1_1BinaryFormatErrorHandler}{BinaryFormatErrorHandler}} m\_error;}
\DoxyCodeLine{126             \mbox{\hyperlink{structLibdas_1_1STLObject}{STLObject}} m\_object;}
\DoxyCodeLine{127             std::ifstream m\_stream;}
\DoxyCodeLine{128             std::string m\_file\_name;}
\DoxyCodeLine{129         }
\DoxyCodeLine{130         \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{131 \textcolor{comment}{            /**}}
\DoxyCodeLine{132 \textcolor{comment}{             * Open file for reading and check if any errors occured during that}}
\DoxyCodeLine{133 \textcolor{comment}{             */}}
\DoxyCodeLine{134             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1BinarySTLParser_af6e8bff00f5ba0cc7435ef058a80d207}{\_OpenFileStream}}();\textcolor{comment}{}}
\DoxyCodeLine{135 \textcolor{comment}{            /**}}
\DoxyCodeLine{136 \textcolor{comment}{             * Load the header signature contents}}
\DoxyCodeLine{137 \textcolor{comment}{             */}}
\DoxyCodeLine{138             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1BinarySTLParser_a4a965b4c6f7287766eaec5edd841dff8}{\_LoadHeader}}();\textcolor{comment}{}}
\DoxyCodeLine{139 \textcolor{comment}{            /**}}
\DoxyCodeLine{140 \textcolor{comment}{             * Extract the model name from STL header}}
\DoxyCodeLine{141 \textcolor{comment}{             * @return std::string instance, describing the name of the model}}
\DoxyCodeLine{142 \textcolor{comment}{             */}}
\DoxyCodeLine{143             std::string \mbox{\hyperlink{classLibdas_1_1BinarySTLParser_acd2f4c0974d24a025ed5e68c41799a77}{\_ExtractModelName}}();}
\DoxyCodeLine{144 }
\DoxyCodeLine{145         \textcolor{keyword}{public}:}
\DoxyCodeLine{146             \mbox{\hyperlink{classLibdas_1_1BinarySTLParser}{BinarySTLParser}}(\textcolor{keyword}{const} std::string \&\_file\_name = \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{147             \mbox{\hyperlink{classLibdas_1_1BinarySTLParser}{\string~BinarySTLParser}}();\textcolor{comment}{}}
\DoxyCodeLine{148 \textcolor{comment}{            /**}}
\DoxyCodeLine{149 \textcolor{comment}{             * Parse either completely new file or existing file}}
\DoxyCodeLine{150 \textcolor{comment}{             */}}
\DoxyCodeLine{151             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1BinarySTLParser_a470656fc2ed265f0fca3ed1ce705ac13}{Parse}}(\textcolor{keyword}{const} std::string \&\_file\_name = \textcolor{stringliteral}{"{}"{}});\textcolor{comment}{}}
\DoxyCodeLine{152 \textcolor{comment}{            /**}}
\DoxyCodeLine{153 \textcolor{comment}{             * Get the parsed STL Object}}
\DoxyCodeLine{154 \textcolor{comment}{             */}}
\DoxyCodeLine{155             \mbox{\hyperlink{structLibdas_1_1STLObject}{STLObject}} \mbox{\hyperlink{classLibdas_1_1BinarySTLParser_a662d79418eca1f9257e2b12b28fca69c}{GetObject}}();}
\DoxyCodeLine{156     \};}
\DoxyCodeLine{157 \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
