\hypertarget{DasWriterCore_8h_source}{}\doxysection{Das\+Writer\+Core.\+h}
\label{DasWriterCore_8h_source}\index{include/DasWriterCore.h@{include/DasWriterCore.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/// libdas: DENG asset handling management library}\textcolor{comment}{}}
\DoxyCodeLine{2 \textcolor{comment}{/// licence: Apache, see LICENCE file}}
\DoxyCodeLine{3 \textcolor{comment}{/// file: DASWriterCore.h -\/ DAS writer parent class header}}
\DoxyCodeLine{4 \textcolor{comment}{/// author: Karl-\/Mihkel Ott}}
\DoxyCodeLine{5 \textcolor{comment}{}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#ifndef DAS\_WRITER\_CORE\_H}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#define DAS\_WRITER\_CORE\_H}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#ifdef DAS\_WRITER\_CORE\_CPP}}
\DoxyCodeLine{11 \textcolor{preprocessor}{    \#include <string>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{    \#include <cstring>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{    \#include <fstream>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{    \#include <type\_traits>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{    \#include <vector>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{    \#include <iostream>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{    \#include <chrono>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{    \#include <ErrorHandlers.h>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{    \#include <Iterators.h>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{    \#include <Vector.h>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{    \#include <Matrix.h>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{    \#include <DasStructures.h>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{    \#include <LibdasAssert.h>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{    \#include <TextureReader.h>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{comment}{// make sure that carriage return is respected in windows}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#ifdef \_WIN32}}
\DoxyCodeLine{31 \textcolor{preprocessor}{    \#define LIBDAS\_DAS\_NEWLINE "{}\(\backslash\)r\(\backslash\)n"{}}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{33 \textcolor{preprocessor}{    \#define LIBDAS\_DAS\_NEWLINE "{}\(\backslash\)n"{}}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceLibdas}{Libdas}} \{}
\DoxyCodeLine{37 }
\DoxyCodeLine{38     \textcolor{keyword}{class }\mbox{\hyperlink{classLibdas_1_1DasWriterCore}{DasWriterCore}} \{}
\DoxyCodeLine{39         \textcolor{keyword}{private}:}
\DoxyCodeLine{40             std::ofstream m\_out\_stream;}
\DoxyCodeLine{41             \textcolor{keywordtype}{bool} m\_use\_compression = \textcolor{keyword}{false};}
\DoxyCodeLine{42 }
\DoxyCodeLine{43         \textcolor{keyword}{protected}:}
\DoxyCodeLine{44             std::string m\_file\_name;}
\DoxyCodeLine{45 }
\DoxyCodeLine{46         \textcolor{keyword}{private}:\textcolor{comment}{}}
\DoxyCodeLine{47 \textcolor{comment}{            /**}}
\DoxyCodeLine{48 \textcolor{comment}{             * Check if the current m\_out\_file string contains extension .das}}
\DoxyCodeLine{49 \textcolor{comment}{             * If not then add it}}
\DoxyCodeLine{50 \textcolor{comment}{             */}}
\DoxyCodeLine{51             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_ab5b5affd6189b6aff7db4c80f21e969f}{\_CheckAndAddFileExtension}}();\textcolor{comment}{}}
\DoxyCodeLine{52 \textcolor{comment}{            /**}}
\DoxyCodeLine{53 \textcolor{comment}{             * Open a output file stream with m\_out\_file as a used file name}}
\DoxyCodeLine{54 \textcolor{comment}{             */}}
\DoxyCodeLine{55             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_ae6fc3f0ca5da600e79a4d207ca9c2a12}{\_OpenFileStream}}();\textcolor{comment}{}}
\DoxyCodeLine{56 \textcolor{comment}{            /**}}
\DoxyCodeLine{57 \textcolor{comment}{             * Write a single string value to the stream}}
\DoxyCodeLine{58 \textcolor{comment}{             * @param \_value\_name is a value name that is used}}
\DoxyCodeLine{59 \textcolor{comment}{             * @param \_value is a string value that is outputted to the stream}}
\DoxyCodeLine{60 \textcolor{comment}{             */}}
\DoxyCodeLine{61             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a1fc0cc25597cb3d6cb8c5f0fb99ab195}{\_WriteStringValue}}(\textcolor{keyword}{const} std::string \&\_value\_name, \textcolor{keyword}{const} std::string \&\_value);\textcolor{comment}{}}
\DoxyCodeLine{62 \textcolor{comment}{            /**}}
\DoxyCodeLine{63 \textcolor{comment}{             * Write a numerical value to the stream}}
\DoxyCodeLine{64 \textcolor{comment}{             * @param \_value\_name is a value name string that is used to define the value}}
\DoxyCodeLine{65 \textcolor{comment}{             * @param \_value is a value in type T that is outputted to stream}}
\DoxyCodeLine{66 \textcolor{comment}{             */}}
\DoxyCodeLine{67             \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{68             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a916bba62f0cb382bdf3f9fe18a38c4d7}{\_WriteNumericalValue}}(\textcolor{keyword}{const} std::string \&\_value\_name, T \_value) \{}
\DoxyCodeLine{69                 LIBDAS\_ASSERT(std::is\_floating\_point<T>::value || std::is\_integral<T>::value);}
\DoxyCodeLine{70                 LIBDAS\_ASSERT(m\_out\_stream.is\_open());}
\DoxyCodeLine{71 }
\DoxyCodeLine{72                 m\_out\_stream.write(\_value\_name.c\_str(), \_value\_name.size());}
\DoxyCodeLine{73                 m\_out\_stream.write(\textcolor{stringliteral}{"{}: "{}}, 2);}
\DoxyCodeLine{74                 m\_out\_stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\&\_value), \textcolor{keyword}{sizeof}(T));}
\DoxyCodeLine{75                 m\_out\_stream.write(LIBDAS\_DAS\_NEWLINE, strlen(LIBDAS\_DAS\_NEWLINE));}
\DoxyCodeLine{76             \}\textcolor{comment}{}}
\DoxyCodeLine{77 \textcolor{comment}{            /**}}
\DoxyCodeLine{78 \textcolor{comment}{             * Write an array value to the stream}}
\DoxyCodeLine{79 \textcolor{comment}{             * @param \_value\_name is a value name string that is used to define the value}}
\DoxyCodeLine{80 \textcolor{comment}{             * @param \_n is the total value count}}
\DoxyCodeLine{81 \textcolor{comment}{             * @param \_values is a T pointer value to the memory area that contains all the array values}}
\DoxyCodeLine{82 \textcolor{comment}{             */}}
\DoxyCodeLine{83             \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{84             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a245b715267b686320e0bcd16720e8d0e}{\_WriteArrayValue}}(\textcolor{keyword}{const} std::string \&\_value\_name, uint32\_t \_n, T *\_values) \{}
\DoxyCodeLine{85                 LIBDAS\_ASSERT(m\_out\_stream.is\_open());}
\DoxyCodeLine{86 }
\DoxyCodeLine{87                 m\_out\_stream.write(\_value\_name.c\_str(), \_value\_name.size());}
\DoxyCodeLine{88                 m\_out\_stream.write(\textcolor{stringliteral}{"{}: "{}}, 2);}
\DoxyCodeLine{89                 m\_out\_stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(\_values), \textcolor{keyword}{sizeof}(T) * \_n);}
\DoxyCodeLine{90             \}\textcolor{comment}{}}
\DoxyCodeLine{91 \textcolor{comment}{            /**}}
\DoxyCodeLine{92 \textcolor{comment}{             * Write a generic data value to the stream}}
\DoxyCodeLine{93 \textcolor{comment}{             * @param \_data is a pointer to the valid data that will be written }}
\DoxyCodeLine{94 \textcolor{comment}{             * @param \_len is a length of the data in bytes}}
\DoxyCodeLine{95 \textcolor{comment}{             * @param \_append\_nl is a boolean flag indicating if the appendix newline should be written or not}}
\DoxyCodeLine{96 \textcolor{comment}{             * @param \_value\_name is a value name string that is used to define the value}}
\DoxyCodeLine{97 \textcolor{comment}{             */}}
\DoxyCodeLine{98             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a45460242311bd2f78ac9e58f6eecbb87}{\_WriteGenericDataValue}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *\_data, \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} \_len, \textcolor{keywordtype}{bool} \_append\_nl = \textcolor{keyword}{true}, \textcolor{keyword}{const} std::string \&\_value\_name = \textcolor{stringliteral}{"{}"{}});\textcolor{comment}{}}
\DoxyCodeLine{99 \textcolor{comment}{            /**}}
\DoxyCodeLine{100 \textcolor{comment}{             * Write a generic 4x4 matrix value to the stream}}
\DoxyCodeLine{101 \textcolor{comment}{             * @param \_value\_name is a value name string that is used to define the value}}
\DoxyCodeLine{102 \textcolor{comment}{             * @param \_mat is a reference to Matrix4<T> object that is written to the stream}}
\DoxyCodeLine{103 \textcolor{comment}{             */}}
\DoxyCodeLine{104             \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{105             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_af5eaf3b45eb502190370948c86191c61}{\_WriteMatrixValue}}(\textcolor{keyword}{const} std::string \&\_value\_name, \textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1Matrix4}{Matrix4<T>}} \&\_mat) \{}
\DoxyCodeLine{106                 LIBDAS\_ASSERT(std::is\_floating\_point<T>::value || std::is\_integral<T>::value);}
\DoxyCodeLine{107                 LIBDAS\_ASSERT(m\_out\_stream.is\_open());}
\DoxyCodeLine{108 }
\DoxyCodeLine{109                 m\_out\_stream.write(\_value\_name.c\_str(), \_value\_name.size());}
\DoxyCodeLine{110                 m\_out\_stream.write(\textcolor{stringliteral}{"{}: "{}}, 2);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112                 \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} it = \_mat.BeginRowMajor(); it != \_mat.EndRowMajor(); it++) \{}
\DoxyCodeLine{113                     m\_out\_stream.write(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const }\textcolor{keywordtype}{char}*\textcolor{keyword}{>}(it.GetData()), \textcolor{keyword}{sizeof}(T));}
\DoxyCodeLine{114                 \}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116                 m\_out\_stream.write(LIBDAS\_DAS\_NEWLINE, strlen(LIBDAS\_DAS\_NEWLINE));}
\DoxyCodeLine{117             \}\textcolor{comment}{}}
\DoxyCodeLine{118 \textcolor{comment}{            /**}}
\DoxyCodeLine{119 \textcolor{comment}{             * Write an animation keyframe to the file}}
\DoxyCodeLine{120 \textcolor{comment}{             * @param \_keyframe is a reference to DasKeyframe object that is written to the stream}}
\DoxyCodeLine{121 \textcolor{comment}{             * @param \_scope\_name is an optional argument that is used to define the scope name (default: "{}KEYFRAME"{})}}
\DoxyCodeLine{122 \textcolor{comment}{             */}}
\DoxyCodeLine{123             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_ab01c9547ce40083c0b0135ffcaa19562}{\_WriteAnimationKeyframe}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasKeyframe}{DasKeyframe}} \&\_keyframe, \textcolor{keyword}{const} std::string \&\_scope\_name = \textcolor{stringliteral}{"{}KEYFRAME"{}});\textcolor{comment}{}}
\DoxyCodeLine{124 \textcolor{comment}{            /**}}
\DoxyCodeLine{125 \textcolor{comment}{             * Write a scene node to the file}}
\DoxyCodeLine{126 \textcolor{comment}{             * @param \_node is a reference to the DasSceneNode object }}
\DoxyCodeLine{127 \textcolor{comment}{             * @param \_scope\_name is an optional argument that is used to define the scope name (default: "{}NODE"{})}}
\DoxyCodeLine{128 \textcolor{comment}{             */}}
\DoxyCodeLine{129             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a4d90c0c697c8610e37c1fdd7c7964ef2}{\_WriteNode}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasSceneNode}{DasSceneNode}} \&\_node, \textcolor{keyword}{const} std::string \&\_scope\_name = \textcolor{stringliteral}{"{}NODE"{}});\textcolor{comment}{}}
\DoxyCodeLine{130 \textcolor{comment}{            /**}}
\DoxyCodeLine{131 \textcolor{comment}{             * Start a new scope definition}}
\DoxyCodeLine{132 \textcolor{comment}{             * @param \_scope\_name is a specified scope name to use when starting a new scope}}
\DoxyCodeLine{133 \textcolor{comment}{             */}}
\DoxyCodeLine{134             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a579a860c5f0e260ef1dd6451feb5ddf6}{\_WriteScopeBeginning}}(\textcolor{keyword}{const} std::string \&\_scope\_name);\textcolor{comment}{}}
\DoxyCodeLine{135 \textcolor{comment}{            /**}}
\DoxyCodeLine{136 \textcolor{comment}{             * Write a scope ending declaration}}
\DoxyCodeLine{137 \textcolor{comment}{             */}}
\DoxyCodeLine{138             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_aed10165e6a121c89757cc23076b8bff1}{\_EndScope}}();}
\DoxyCodeLine{139 }
\DoxyCodeLine{140 }
\DoxyCodeLine{141         \textcolor{keyword}{public}:}
\DoxyCodeLine{142             \mbox{\hyperlink{classLibdas_1_1DasWriterCore}{DasWriterCore}}(\textcolor{keyword}{const} std::string \&\_file\_name = \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{143             \mbox{\hyperlink{classLibdas_1_1DasWriterCore}{\string~DasWriterCore}}();\textcolor{comment}{}}
\DoxyCodeLine{144 \textcolor{comment}{            /**}}
\DoxyCodeLine{145 \textcolor{comment}{             * Open a new file for output}}
\DoxyCodeLine{146 \textcolor{comment}{             * @param \_file\_name is a new file name to use when opening a stream}}
\DoxyCodeLine{147 \textcolor{comment}{             */}}
\DoxyCodeLine{148             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a009f3a911d48931dd7af28a9fefb49fc}{NewFile}}(\textcolor{keyword}{const} std::string \&\_file\_name);\textcolor{comment}{}}
\DoxyCodeLine{149 \textcolor{comment}{            /**}}
\DoxyCodeLine{150 \textcolor{comment}{             * Close the stream if opened}}
\DoxyCodeLine{151 \textcolor{comment}{             */}}
\DoxyCodeLine{152             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a8013d86572d3fe7a03e02be84dbf40f3}{CloseStream}}();\textcolor{comment}{}}
\DoxyCodeLine{153 \textcolor{comment}{            /**}}
\DoxyCodeLine{154 \textcolor{comment}{             * Write a file signature with its properties section}}
\DoxyCodeLine{155 \textcolor{comment}{             * @param \_properties is a reference to DasProperties}}
\DoxyCodeLine{156 \textcolor{comment}{             */}}
\DoxyCodeLine{157             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a363a34dad27c23cc934f19f003fc58f9}{InitialiseFile}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasProperties}{DasProperties}} \&\_properties);\textcolor{comment}{}}
\DoxyCodeLine{158 \textcolor{comment}{            /**}}
\DoxyCodeLine{159 \textcolor{comment}{             * Write a generic buffer scope into a file}}
\DoxyCodeLine{160 \textcolor{comment}{             * @param \_buffer is a reference to DasBuffer object}}
\DoxyCodeLine{161 \textcolor{comment}{             */}}
\DoxyCodeLine{162             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a5ddcbc786d664e4c5e3f170db976d40d}{WriteBuffer}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasBuffer}{DasBuffer}} \&\_buffer);\textcolor{comment}{}}
\DoxyCodeLine{163 \textcolor{comment}{            /**}}
\DoxyCodeLine{164 \textcolor{comment}{             * Write texture buffers from given texture images files}}
\DoxyCodeLine{165 \textcolor{comment}{             * @param \_textures is a const reference to std::vector that contains all texture file names in std::string type}}
\DoxyCodeLine{166 \textcolor{comment}{             */}}
\DoxyCodeLine{167             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a53be9ac83e8e861eff6e96744484ef0c}{WriteTextureBuffer}}(\textcolor{keyword}{const} std::vector<std::string> \&\_textures);\textcolor{comment}{}}
\DoxyCodeLine{168 \textcolor{comment}{            /**}}
\DoxyCodeLine{169 \textcolor{comment}{             * Write a model information to a file}}
\DoxyCodeLine{170 \textcolor{comment}{             * @param \_model is a reference to DasModel object}}
\DoxyCodeLine{171 \textcolor{comment}{             */}}
\DoxyCodeLine{172             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a1495bcb6ee848cf332bdc97fc0f8f6c4}{WriteModel}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasModel}{DasModel}} \&\_model);\textcolor{comment}{}}
\DoxyCodeLine{173 \textcolor{comment}{            /**}}
\DoxyCodeLine{174 \textcolor{comment}{             * Write an animation information to the file}}
\DoxyCodeLine{175 \textcolor{comment}{             * @param \_animation is a reference to DasAnimation object}}
\DoxyCodeLine{176 \textcolor{comment}{             */}}
\DoxyCodeLine{177             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_acc3f986616ada0d2c0c0b9c3438dadda}{WriteAnimation}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasAnimation}{DasAnimation}} \&\_animation);\textcolor{comment}{}}
\DoxyCodeLine{178 \textcolor{comment}{            /**}}
\DoxyCodeLine{179 \textcolor{comment}{             * Write a scene info to the stream}}
\DoxyCodeLine{180 \textcolor{comment}{             * @param \_scene is a reference to DasScene object}}
\DoxyCodeLine{181 \textcolor{comment}{             */}}
\DoxyCodeLine{182             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a274975703394f6d6620223f96b27b95b}{WriteScene}}(\textcolor{keyword}{const} \mbox{\hyperlink{structLibdas_1_1DasScene}{DasScene}} \&\_scene);\textcolor{comment}{}}
\DoxyCodeLine{183 \textcolor{comment}{            /**}}
\DoxyCodeLine{184 \textcolor{comment}{             * Check if compression is needed and if it is then compress it using Huffman algorithm}}
\DoxyCodeLine{185 \textcolor{comment}{             */}}
\DoxyCodeLine{186             \textcolor{keywordtype}{void} \mbox{\hyperlink{classLibdas_1_1DasWriterCore_a0657d74477062774b47fc312f37f7537}{CheckAndCompressFile}}();}
\DoxyCodeLine{187     \};}
\DoxyCodeLine{188 \}}
\DoxyCodeLine{189 }
\DoxyCodeLine{190 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
